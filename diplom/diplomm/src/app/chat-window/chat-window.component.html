<div class="chat-window" *ngIf="selectedChat;">
  <div class="chat-header">
    <div class="chat-info">
      <div class="avatar-container">
        <div class="avatar">
          <img [src]="selectedChat.avatar" [alt]="selectedChat.name" />
        </div>
        <div class="online-indicator" [class.online]="selectedChat.isOnline"></div>
      </div>

      <div class="chat-details">
        <h2 class="chat-name">{{ selectedChat.name }}</h2>
        <p class="chat-status" [class.online]="selectedChat.isOnline">
          {{ selectedChat.isOnline ? 'Online' : 'Offline' }}
        </p>
      </div>
    </div>

    <div class="chat-actions">
      <button class="action-btn" title="Search in chat">
        ğŸ”
      </button>
      <button class="action-btn" title="More options">
        â‹®
      </button>
    </div>
  </div>

  <div class="messages-container" #messagesContainer>
    <div class="messages">
      <div class="date-divider" *ngIf="messages.length > 0">
        <span>{{ isTodayMessage(messages[0].time) ? 'Today' : 'Yesterday' }}</span>
      </div>

      <div *ngFor="let message of messages; let i = index" 
           class="message-wrapper"
           [class.outgoing]="message.isOutgoing"
           [class.with-avatar]="!message.isOutgoing && shouldShowAvatar(i)"
           [class.active]="isMessageActive(message.id || '')"
           [class.deleting]="getMessageClass(message.id || '') === 'deleting'"
           (click)="onMessageClick(message.id || '', $event)">
        
        <div class="message-avatar" *ngIf="!message.isOutgoing && shouldShowAvatar(i)">
          <img [src]="selectedChat.avatar" [alt]="selectedChat.name" />
        </div>

        <div class="avatar-placeholder" *ngIf="message.isOutgoing"></div>

        <div class="message" [class.with-avatar]="!message.isOutgoing && shouldShowAvatar(i)">
          <div class="sender-name" *ngIf="!message.isOutgoing && message.senderName && shouldShowAvatar(i)">
            {{ message.senderName }}
          </div>

          <div class="message-bubble">
            <app-message-reply 
              *ngIf="message.replyTo" 
              [replyTo]="message.replyTo"
            ></app-message-reply>
            
            <p class="message-text">{{ message.text }}</p>
            
            <div class="message-footer">
              <span class="message-time">{{ getMessageTime(message.time) }}</span>
              
              <span class="message-status" *ngIf="message.isOutgoing">
                {{ message.status === 'read' ? 'âœ“âœ“' : 
                   message.status === 'delivered' ? 'âœ“âœ“' : 'âœ“' }}
              </span>
            </div>
            
            <div class="message-actions" *ngIf="shouldShowActions(message.id || '')">
              <button 
                class="action-btn delete-action-btn" 
                (click)="deleteMessage(message.id || '', $event)"
                title="Delete message"
              >
                ğŸ—‘ï¸
              </button>
              
              <button 
                class="action-btn reply-action-btn" 
                (click)="startReply(message, $event)"
                title="ĞÑ‚Ğ²ĞµÑ‚ Ğ½Ğ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ"
              >
                â†©ï¸
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="message-input-container">
    <app-reply-preview
      *ngIf="replyState?.isReplying"
      [replyTo]="replyState?.replyTo"
      [originalMessageId]="replyState?.originalMessageId"
      (cancel)="cancelReply()"
    ></app-reply-preview>
    
    <div class="input-actions">
      <button class="action-btn" title="Attach file">
        ğŸ“
      </button>
      <button 
        class="action-btn emoji-toggle" 
        title="Emoji"
        (click)="toggleEmojiPanel($event)"
        [class.active]="showEmojiPanel"
      >
        ğŸ˜€
      </button>
    </div>

    <div class="input-wrapper">
      <textarea 
        class="message-input" 
        placeholder="Type a message..."
        [(ngModel)]="newMessage"
        (keydown)="onKeyPress($event)"
        rows="1"
        #messageInput
      ></textarea>
    </div>

    <button 
      class="send-btn" 
      (click)="sendMessage()"
      [disabled]="!newMessage.trim()"
    >
      Send
    </button>
  </div>

  <app-emoji-panel 
    *ngIf="showEmojiPanel"
    (emojiSelected)="onEmojiSelected($event)"
    (panelClosed)="closeEmojiPanel()"
  >
  </app-emoji-panel>
</div>
